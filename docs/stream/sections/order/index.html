<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Multithreading and order
  #


  Multithreading
  #

We can allow a whole stream pipeline to be executed in a concurrent or parallel fashion, for instance with the instance method Stream.parallel, as follows:

Example.
List&lt;Integer&gt;list = List.of(1, 2, 3);

// Contains [3,4,5]
List&lt;Integer&gt; ouputList = list.stream()
                            .parallel()
                            .map(i -&gt; i &#43; 2)
                            .toList();

This allows the JVM to take advantage of available resources to execute operations (like the map operation in this example) in several threads, concurrently.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/stream/sections/order/">
  <meta property="og:site_name" content="Programming project 2024-25">
  <meta property="og:title" content="Multithreading and order">
  <meta property="og:description" content="Multithreading and order # Multithreading # We can allow a whole stream pipeline to be executed in a concurrent or parallel fashion, for instance with the instance method Stream.parallel, as follows:
Example.
List&lt;Integer&gt;list = List.of(1, 2, 3); // Contains [3,4,5] List&lt;Integer&gt; ouputList = list.stream() .parallel() .map(i -&gt; i &#43; 2) .toList(); This allows the JVM to take advantage of available resources to execute operations (like the map operation in this example) in several threads, concurrently.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>Multithreading and order | Programming project 2024-25</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/docs/stream/sections/order/">
<link rel="stylesheet" href="/book.min.434035e7885c7f5d12818bd9f111cf1a0925c6fb78382667381c3d5eda3fb4f1.css" integrity="sha256-Q0A154hcf10SgYvZ8RHPGgklxvt4OCZnOBw9Xto/tPE=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.ca9333395f39812077e8cc12fcf95059280455fd98b16d80c90ce7dfc46d2044.js" integrity="sha256-ypMzOV85gSB36MwS/PlQWSgEVf2YsW2AyQzn38RtIEQ=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Programming project 2024-25</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-85f15178f01450fce91df9efce108685" class="toggle"  />
    <label for="section-85f15178f01450fce91df9efce108685" class="flex justify-between">
      <a href="/docs/intro/" class="">This course</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/schedule/" class="">Schedule</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/lecturers/" class="">Teaching staff</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/evaluation/" class="">Evaluation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/content/" class="">Content</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/board_game/" class="">Board game</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/bibliography/" class="">Additional resources</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-29012f2cba9206afc50d2993e3920e12" class="toggle"  />
    <label for="section-29012f2cba9206afc50d2993e3920e12" class="flex justify-between">
      <a href="/docs/objects/" class="">Objects and classes</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Multithreading and order</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#multithreading">Multithreading</a></li>
    <li><a href="#order">Order</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="multithreading-and-order">
  Multithreading and order
  <a class="anchor" href="#multithreading-and-order">#</a>
</h1>
<h2 id="multithreading">
  Multithreading
  <a class="anchor" href="#multithreading">#</a>
</h2>
<p>We can allow a whole stream pipeline to be executed in a <a href="">concurrent or parallel</a> fashion, for instance with the instance method <code>Stream.parallel</code>, as follows:</p>
<blockquote class="book-hint info">
<p><strong><em>Example.</em></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span>list <span style="color:#f92672">=</span> List.<span style="color:#a6e22e">of</span>(1, 2, 3);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Contains [3,4,5]</span>
</span></span><span style="display:flex;"><span>List<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> ouputList <span style="color:#f92672">=</span> list.<span style="color:#a6e22e">stream</span>()
</span></span><span style="display:flex;"><span>                            .<span style="color:#a6e22e">parallel</span>()
</span></span><span style="display:flex;"><span>                            .<span style="color:#a6e22e">map</span>(i <span style="color:#f92672">-&gt;</span> i <span style="color:#f92672">+</span> 2)
</span></span><span style="display:flex;"><span>                            .<span style="color:#a6e22e">toList</span>();
</span></span></code></pre></div></blockquote>
<p>This allows the JVM to take advantage of available resources to execute operations (like the <code>map</code> operation in this example) in several threads, concurrently.</p>
<h2 id="order">
  Order
  <a class="anchor" href="#order">#</a>
</h2>
<p>From the Javadoc of the package <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/package-summary.html">java.util.stream</a>, if the source of a stream is ordered (e.g. a <code>List</code>), then the effect of an operation on the stream is usually predictable.</p>
<p>Indeed, most operations are constrained to operate on the elements in their &ldquo;encounter order&rdquo;.
For instance,
if the source of a stream is a <code>List</code> containing <code>[1, 2, 3]</code>, then the result of executing <code>map(x -&gt; x * 2)</code> must be <code>[2, 4, 6]</code>.</p>
<p>However, in some cases, the terminal operation <code>forEach</code> may ignore the encounter order.
If the stream is executed sequentially (which is the case by default), then this usually has no effect on execution.
But if the stream is executed in parallel, then this is likely to affect the output.</p>
<p>In such a case, the terminal operation <code>forEachOrdered</code> may be used instead of <code>forEach</code>, in order to force this operation to respect the encounter order.</p>
<blockquote class="book-hint info">
<p><strong><em>Example.</em></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span>list <span style="color:#f92672">=</span> List.<span style="color:#a6e22e">of</span>(1, 2, 3);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Must output `2` `4` and `6, in this order.</span>
</span></span><span style="display:flex;"><span>list.<span style="color:#a6e22e">stream</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">parallel</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">map</span>(x <span style="color:#f92672">-&gt;</span> x <span style="color:#f92672">*</span> 2)
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">forEachOrdered</span>(System.<span style="color:#a6e22e">out</span>::println);
</span></span></code></pre></div></blockquote>
<p>Besides, it is possible to relax the ordering constraint with the instance method <code>Stream.unordered()</code>.
This may improve performance for pipelines with costly operations,
in scenarios where the order of processing is irrelevant.</p>
<blockquote class="book-hint info">
<p><strong><em>Example.</em></strong>
In this example, the order in which the elements of the stream are processed is irrelevant because:</p>
<ul>
<li>the map applies a pure function, and</li>
<li>the stream is collected as a set.</li>
</ul>
<p>This is why calling the <code>unordered</code> method is safe.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List<span style="color:#f92672">&lt;</span>MyClass<span style="color:#f92672">&gt;</span>list <span style="color:#f92672">=</span> getList();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>list.<span style="color:#a6e22e">stream</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">parallel</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">unordered</span>()
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">map</span>(o <span style="color:#f92672">-&gt;</span> expensivePureFunction(o))
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toSet</span>());
</span></span></code></pre></div></blockquote>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#multithreading">Multithreading</a></li>
    <li><a href="#order">Order</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












