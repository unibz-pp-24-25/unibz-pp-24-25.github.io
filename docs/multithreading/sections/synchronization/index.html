<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Synchronization
  #

The behavior of a program that runs multiple threads can be hard to predict.
In particular, two threads may compete to access a same resource (e.g. the value of some object&rsquo;s attribute),
without guarantee on the order in which they access it.
This may lead (among other things) to a race condition
Programming languages that support multithreading also allow expressing constraints on the order of execution of some instructions.
For instance, we saw earlier that a thread can be forced to wait for a child thread to terminate before resuming its execution.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://unibz-pp-24-25.github.io/docs/multithreading/sections/synchronization/">
  <meta property="og:site_name" content="Programming project 2024-25">
  <meta property="og:title" content="Synchronization">
  <meta property="og:description" content="Synchronization # The behavior of a program that runs multiple threads can be hard to predict. In particular, two threads may compete to access a same resource (e.g. the value of some objectâ€™s attribute), without guarantee on the order in which they access it. This may lead (among other things) to a race condition
Programming languages that support multithreading also allow expressing constraints on the order of execution of some instructions. For instance, we saw earlier that a thread can be forced to wait for a child thread to terminate before resuming its execution.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>Synchronization | Programming project 2024-25</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://unibz-pp-24-25.github.io/docs/multithreading/sections/synchronization/">
<link rel="stylesheet" href="/book.min.f0351d5c25e0eea9082c331897093f7196a63e3b47c9191bec02c70e7740621c.css" integrity="sha256-8DUdXCXg7qkILDMYlwk/cZamPjtHyRkb7ALHDndAYhw=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.08f8cf69c9fcdd7db2efbe3e7f874ec5171414c6d81453f0e8f920dc8e32413b.js" integrity="sha256-CPjPacn83X2y774&#43;f4dOxRcUFMbYFFPw6Pkg3I4yQTs=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
  integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0"
  crossorigin="anonymous"
/>


<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
  integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4"
  crossorigin="anonymous"
></script>


<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
  integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
  crossorigin="anonymous"
  onload="renderMathInElement(document.body);"
></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ],
    });
  });
</script>

</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Programming project 2024-25</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-85f15178f01450fce91df9efce108685" class="toggle"  />
    <label for="section-85f15178f01450fce91df9efce108685" class="flex justify-between">
      <a href="/docs/intro/" class="">This course</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/schedule/" class="">Schedule</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/lecturers/" class="">Teaching staff</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/evaluation/" class="">Evaluation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/content/" class="">Content</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/board_game/" class="">Board game</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/bibliography/" class="">Additional resources</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/intro/sections/quiz/" class="">Quiz</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ba33d8a9bf780b57832f569fe09e5c26" class="toggle"  />
    <label for="section-ba33d8a9bf780b57832f569fe09e5c26" class="flex justify-between">
      <a href="/docs/project/" class="">Project</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/project/sections/free_project/" class="">Option 1: free project</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/project/sections/board_game/" class="">Option 2: board game</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-29012f2cba9206afc50d2993e3920e12" class="toggle"  />
    <label for="section-29012f2cba9206afc50d2993e3920e12" class="flex justify-between">
      <a href="/docs/objects/" class="">Objects and classes</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/objects/" class="">Objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/classes/" class="">Class and instance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/inheritance/" class="">Inheritance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/methods/" class="">Instance methods</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/tostring/" class="">Displaying objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/comparing/" class="">Cast and equality</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/classesasobjects/" class="">Classes as objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/quasi-objects/" class="">Quasi-objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/clone/" class="">Duplicating objects</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/encapsulation/" class="">Encapsulation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/mutability/" class="">Mutability</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/objects/sections/quiz/" class="">Quiz</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5933d7510d07450e8c15a6a0ebd380b0" class="toggle"  />
    <label for="section-5933d7510d07450e8c15a6a0ebd380b0" class="flex justify-between">
      <a href="/docs/interfaces/" class="">Interfaces</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/interfaces/sections/specification/" class="">Specification and programming interface</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/interfaces/sections/java_interfaces/" class="">Java interfaces</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6bfaa2b89c0853780e84ab9c868d56bd" class="toggle"  />
    <label for="section-6bfaa2b89c0853780e84ab9c868d56bd" class="flex justify-between">
      <a href="/docs/abstractdatatypes/" class="">Abstract data types</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/list/" class="">List</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/set/" class="">Set</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/map/" class="">Associative array</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/queue/" class="">Stack, queue, priority queue</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/abstractdatatypes/sections/sorting/" class="">Sorting</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2de9da23438414913111ffd05054662f" class="toggle"  />
    <label for="section-2de9da23438414913111ffd05054662f" class="flex justify-between">
      <a href="/docs/datastructures/" class="">Data structures</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/datastructures/sections/list/" class="">Dynamic array and linked list</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/datastructures/sections/hash/" class="">Hash table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/datastructures/sections/tree/" class="">Binary search tree</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-50027a2c524e8f72a4c6b2a6d8cec98e" class="toggle"  />
    <label for="section-50027a2c524e8f72a4c6b2a6d8cec98e" class="flex justify-between">
      <a href="/docs/errors/" class="">Errors</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/errors/sections/callstack/" class="">Call stack</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/errors/sections/exceptions/" class="">Exceptions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/errors/sections/checked/" class="">Runtime vs checked exceptions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/errors/sections/custom/" class="">Custom exceptions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/errors/sections/errors/" class="">Java errors</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-fb154713c839715a5585b2a7913c99b5" class="toggle"  />
    <label for="section-fb154713c839715a5585b2a7913c99b5" class="flex justify-between">
      <a href="/docs/recursion/" class="">Recursion</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/recursion/sections/linear/" class="">Linear recursion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/recursion/sections/nary/" class="">N-ary recursion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/recursion/sections/correctness/" class="">Correctness</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-dc278ca0f2b5fde4dfe6c2fa75ea1c98" class="toggle"  />
    <label for="section-dc278ca0f2b5fde4dfe6c2fa75ea1c98" class="flex justify-between">
      <a href="/docs/input/" class="">I/O and serialization</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/input/sections/files/" class="">Paths and files in Java</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/input/sections/read/" class="">Reading from and writing to a file in Java</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/input/sections/property/" class="">Configuration files</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/input/sections/serialize/" class="">Serialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/input/sections/json/" class="">JSON Serialization</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-35cd663b1751527caf51f3abaa1d3f77" class="toggle"  />
    <label for="section-35cd663b1751527caf51f3abaa1d3f77" class="flex justify-between">
      <a href="/docs/lambda/" class="">First-class methods</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/functional/" class="">Functional programming</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/pure/" class="">Pure function</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/anonymous/" class="">Anonymous method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/lambda/" class="">Lambda expression</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/type/" class="">Type of a method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/callback/" class="">Callback method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/closure/" class="">Free variable and closure</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/lambda/sections/currying/" class="">Currying</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3f93e1aa0bccac696ec9af373a353010" class="toggle"  />
    <label for="section-3f93e1aa0bccac696ec9af373a353010" class="flex justify-between">
      <a href="/docs/stream/" class="">Streams in Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/pipeline/" class="">Pipeline</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/init/" class="">Source</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/intermediate/" class="">Intermediate operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/terminal/" class="">Terminal operation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/numeric/" class="">Numeric stream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/order/" class="">Multithreading and order</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/stream/sections/optional/" class="">Optional</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0c3cfe6ac985c7980a60c7f9b6c91241" class="toggle"  />
    <label for="section-0c3cfe6ac985c7980a60c7f9b6c91241" class="flex justify-between">
      <a href="/docs/generics/" class="">Generic programming</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/type_checking/" class="">Type checking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/generics/" class="">Generics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/subtype/" class="">Subtype</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/variance/" class="">Variance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/generics/sections/erasure/" class="">Type erasure</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e2a96fb94742b1e663314eaa5e569503" class="toggle" checked />
    <label for="section-e2a96fb94742b1e663314eaa5e569503" class="flex justify-between">
      <a href="/docs/multithreading/" class="">Multithreading</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/concurrency/" class="">Concurrency</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/thread/" class="">Process vs thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/simple/" class="">A simplified view</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/race/" class="">Race condition</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/synchronization/" class="active">Synchronization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/troubleshooting/" class="">Troubleshooting</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/multithreading/sections/abstractions/" class="">Abstractions</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-dec6c566dc70f820bab9ec7ff47ae94b" class="toggle"  />
    <label for="section-dec6c566dc70f820bab9ec7ff47ae94b" class="flex justify-between">
      <a href="/docs/unittests/" class="">Unit tests</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/unittests/sections/structured/" class="">Code units</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/unittests/sections/tdd/" class="">Development driven by unit tests</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/unittests/sections/junit/" class="">in Java</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-84599da0227dcb54f4402978878c76ee" class="toggle"  />
    <label for="section-84599da0227dcb54f4402978878c76ee" class="flex justify-between">
      <a href="/docs/simplify/" class="">Simplifying code</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/simplify/sections/factorization/" class="">Factorizing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/simplify/sections/break/" class="">Break statements and flags</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/simplify/sections/boolean/" class="">Boolean conditions</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a9c9fe6c549336d0426f7d22637c8205" class="toggle"  />
    <label for="section-a9c9fe6c549336d0426f7d22637c8205" class="flex justify-between">
      <a href="/docs/env/" class="">Development environment</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/files/" class="">Hierarchical file system</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/backup/" class="">Backup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/install/" class="">Software management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/os/" class="">Operating system</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/requirements/" class="">Requirements for this course</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/text_editor/" class="">Text editor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/ide/" class="">IDE</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/eval/" class="">Evaluation environment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/env/sections/terminal/" class="">Terminal</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f1c5296cc17be274316dd1d777e04506" class="toggle"  />
    <label for="section-f1c5296cc17be274316dd1d777e04506" class="flex justify-between">
      <a href="/docs/git/" class="">Git</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/basics/" class="">Basics: repository, commits and branches</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/collaboration/" class="">Basics: network and collaboration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/config/" class="">Configuration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/create/" class="">Create or clone a repository</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/navigate/" class="">Navigation, status and history: status, log, checkout, diff, show</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/commit/" class="">Add, commit, stash</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/branches/" class="">Branches</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/sharing/" class="">Synchronization: remote, push, pull</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/backtracking/" class="">Backtracking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/resources/" class="">To go further</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/git/sections/ignore/" class="">Ignore</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f207d34fa930b6f6e13e4f97a94bc96f" class="toggle"  />
    <label for="section-f207d34fa930b6f6e13e4f97a94bc96f" class="flex justify-between">
      <a href="/docs/build/" class="">Build automation</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/build/sections/packaging/" class="">Packaging a Java application</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/build/sections/layout/" class="">Layout</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/build/sections/pom/" class="">Configuration file</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/build/sections/artifact/" class="">Artifact</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/build/sections/dependencies/" class="">Dependencies</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/build/sections/building/" class="">Building</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6afd72ae37923560357201746de85ea9" class="toggle"  />
    <label for="section-6afd72ae37923560357201746de85ea9" class="flex justify-between">
      <a href="/docs/background/" class="">Background</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/problem/" class="">Computational problem</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/set_tuple_map/" class="">Set, tuple, function</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/order/" class="">Relation, preorder</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/background/sections/cost/" class="">Computational cost</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Synchronization</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#mutual_exclusion">Mutual exclusion</a>
      <ul>
        <li><a href="#in-java">in Java</a></li>
      </ul>
    </li>
    <li><a href="#condition_variable">Condition variables</a>
      <ul>
        <li><a href="#producerConsumer">The producer/consumer pattern</a></li>
        <li><a href="#in-java-1">in Java</a></li>
        <li><a href="#spurious-wakeup">Spurious wakeup</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="synchronization">
  Synchronization
  <a class="anchor" href="#synchronization">#</a>
</h1>
<p>The behavior of a program that runs multiple threads can be hard to predict.
In particular, two threads may compete to access a same resource (e.g. the value of some object&rsquo;s attribute),
without guarantee on the <em>order</em> in which they access it.
This may lead (among other things) to a <a href="https://unibz-pp-24-25.github.io/docs/multithreading/sections/race/">race condition</a></p>
<p>Programming languages that support multithreading also allow expressing <em>constraints</em> on the order of execution of some instructions.
For instance, we saw <a href="https://unibz-pp-24-25.github.io/docs/multithreading/sections/simple/#spawnSync">earlier</a> that a thread can be forced to wait for a child thread to terminate before resuming its execution.</p>
<p>In this section, we review two additional mechanisms (<a href="#mutual_exclusion">mutual exclusion</a> and <a href="#condition_variable">condition variables</a>) that allow synchronizing the behaviors of threads.</p>
<p>For a more exhaustive overview of the possibilities offered by Java in that regard, we refer to the Javadoc of the package <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/package-summary.html">java.util.concurrent</a>.
In particular, it summarizes the situations where a Java statement <em>must</em> be executed before another (in Java&rsquo;s terminology, this binary relation over statements is called the &ldquo;happens before&rdquo; relation).</p>
<!--Let $a_1$ (resp. $a_2$) be an instruction executed in a thread $t_1$ (resp. $t_2$).-->
<!--By default, if $t_1$ and $t_2$ are executed concurrently, there is no guarantee that $a_1$ is executed before $a_2$.-->
<!--However, most programming languages provide mechanisms to enforce it.-->
<h2 id="mutual_exclusion">
  Mutual exclusion
  <a class="anchor" href="#mutual_exclusion">#</a>
</h2>
<blockquote class="book-hint warning">
<p><strong>Mutual exclusion</strong> prevents two threads to access a same resource concurrently.
This is generally achieved via some kind of <strong>lock</strong> (sometimes called a <strong>mutex</strong> or <strong>semaphore</strong>).</p>
</blockquote>
<p>Most programming languages that support concurrency provide mechanisms for mutual exclusion.
These languages include C/C++, C#, Go, Java, PHP, Python, or Rust.</p>
<h3 id="in-java">
  in Java
  <a class="anchor" href="#in-java">#</a>
</h3>
<blockquote class="book-hint warning">
<p>Java associates to each object a so-called <strong>intrinsic lock</strong> (also called <strong>monitor lock</strong> or simply <strong>monitor</strong>).</p>
<p>If a thread $t_1$ <strong>acquires</strong> the intrinsic lock of an object, then a different thread $t_2$ cannot acquire this lock until $t_1$ has <strong>released</strong> it (however, a thread can reacquire a lock that it already owns).</p>
</blockquote>
<p>The Java keyword <code>synchronized</code> enforces mutual exclusion via an intrinsic lock.
In can be used in two ways:</p>
<h4 id="syncStatement">
  Synchronized statement
  <a class="anchor" href="#syncStatement">#</a>
</h4>
<blockquote class="book-hint warning">
<p>A <strong>synchronized statement</strong> associates an object $o$ to a <em>block</em> of code (called a <strong>synchronized block</strong>).</p>
<p>A thread that enters this block acquires the intrinsic lock of $o$, and releases it when exits the block.</p>
</blockquote>
<p>The syntax is the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">synchronized</span>(<span style="color:#f92672">&lt;</span>object<span style="color:#f92672">&gt;</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span>code block<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote class="book-hint info">
<p><strong><em>Example.</em></strong>
Consider the two following classes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Counter</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Counter</span>(<span style="color:#66d9ef">int</span> value){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Lock</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The method <code>increment</code> below uses an instance of <code>Lock</code> to ensure that a counter is only incremented by one thread at a time:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">increment</span>(Counter counter, Lock lock){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span>(lock){
</span></span><span style="display:flex;"><span>        counter.<span style="color:#a6e22e">value</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As a result, the following program is free of race condition:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Counter counter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Counter(0);
</span></span><span style="display:flex;"><span>Lock lock <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Lock();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> { increment(counter, lock); } );
</span></span><span style="display:flex;"><span>Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> { increment(counter, lock); } );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>t1.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>t2.<span style="color:#a6e22e">start</span>();
</span></span></code></pre></div></blockquote>
<p>Observe that in the example above, any object could be used as a lock.
In particular, the object <code>counter</code> itself.
So the program below is equivalent:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">increment</span>(Counter counter){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span>(counter){
</span></span><span style="display:flex;"><span>        counter.<span style="color:#a6e22e">value</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Counter counter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Counter(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> { increment(counter); } );
</span></span><span style="display:flex;"><span>Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> { increment(counter); } );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>t1.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>t2.<span style="color:#a6e22e">start</span>();
</span></span></code></pre></div><h4 id="syncMethod">
  Synchronized method
  <a class="anchor" href="#syncMethod">#</a>
</h4>
<blockquote class="book-hint warning">
<p>A <strong>synchronized instance method</strong> uses the intrinsic lock of the object for which this method is called.</p>
</blockquote>
<p>The syntax is the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">myMethod</span>() {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In other words, the two following classes are equivalent:</p>
<div class="book-columns flex flex-wrap">
<div class="flex-even markdown-inner" style="flex-grow: 1;">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">myMethod</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>method body<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  </div>
<div class="flex-even markdown-inner" style="flex-grow: 1;">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">myMethod</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">synchronized</span>(<span style="color:#66d9ef">this</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>method body<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  </div>
</div>
<blockquote class="book-hint danger">
<p><strong><em>Warning.</em></strong>
A constructor <em>cannot</em> be synchronized (the program will not compile).</p>
</blockquote>
<blockquote class="book-hint info">
<p><strong><em>Observation.</em></strong>
Let $m$ be a synchronized instance method, let $o$ be an object, let $t_1$ and $t_2$ be two different threads, and let us assume that $t_1$ executes $o.m$ (i.e. $t_1$ executes the method $m$ for the object $o$).</p>
<p>Then $t_2$ cannot execute <em>any</em> synchronized method for $o$ before the termination of $o.m$ (since $t_1$ acquired the lock on the object $o$).</p>
</blockquote>
<blockquote class="book-hint info">
<p><strong><em>Observation.</em></strong>
We mentioned above that a thread can reacquire a lock that it already owns.</p>
<p>As a consequence, for the same object, a synchronized method can call another, as long as they are executed by the same thread.</p>
</blockquote>
<div class="book-tabs">
<input type="radio" class="toggle" name="tabs-exercise_synchronized" id="tabs-exercise_synchronized-0" checked="checked" />
<label for="tabs-exercise_synchronized-0">Exercise</label>
<div class="book-tabs-content markdown-inner"><p>What are the possible outputs of the following program?</p>
<p>And what would these possible outputs be if the method <code>getValue()</code> were <em>not</em> synchronized?</p>
<p>Can the value <code>3</code> be printed, and if so, in which precise scenario(s)?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Counter</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Counter</span>(<span style="color:#66d9ef">int</span> value){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">inc</span>(<span style="color:#66d9ef">int</span> delta){
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> delta;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doubleDec</span>(<span style="color:#66d9ef">int</span> delta){
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">-=</span> delta;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">-=</span> delta;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getValue</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Counter counter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Counter(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> { counter.<span style="color:#a6e22e">doubleDec</span>(2); } );
</span></span><span style="display:flex;"><span>t1.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread( () <span style="color:#f92672">-&gt;</span> { counter.<span style="color:#a6e22e">inc</span>(5); } );
</span></span><span style="display:flex;"><span>t2.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(counter.<span style="color:#a6e22e">getValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    t1.<span style="color:#a6e22e">join</span>();
</span></span><span style="display:flex;"><span>    t2.<span style="color:#a6e22e">join</span>();
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(counter.<span style="color:#a6e22e">getValue</span>());
</span></span></code></pre></div></div>
<input type="radio" class="toggle" name="tabs-exercise_synchronized" id="tabs-exercise_synchronized-1"  />
<label for="tabs-exercise_synchronized-1">Solution</label>
<div class="book-tabs-content markdown-inner"><p>Because the two methods <code>inc</code> and <code>doubleDec</code> are synchronized (and are called for the same object), their executions cannot interleave.
This rules out race conditions, so the <em>second</em> print statement must output <code>1</code>.</p>
<p>As for the first print statement, observe that:</p>
<ul>
<li>there is no guarantee on the order of execution of <code>counter.inc(5)</code>, <code>counter.doubleDec(2)</code> and the first call to <code>counter.getvalue()</code>.</li>
<li>the method <code>getValue()</code> is synchronized, so it cannot be called during the execution of <code>counter.doubleDec(2)</code>.</li>
</ul>
<p>So the possible output values here are
<code>-4</code>,
<code>0</code>,
<code>1</code>
and <code>5</code>.</p>
<p>If the method <code>getValue()</code> were not synchronized, then it could be called during the execution of <code>counter.doubleDec(2)</code>.
In this case, the possible outputs values would be
<code>-4</code>,
<code>-2</code>,
<code>0</code>,
<code>1</code>,
<code>3</code> and
<code>5</code>.</p>
<p>The value <code>3</code> can only be printed in the second case, and only if the counter was first incremented by <code>5</code>, and then decremented by <code>2</code>.
The counter cannot be first decremented by 2 and then (immediately) incremented by 5, because the methods <code>inc</code> and <code>doubleDec</code> are synchronized.</p>
</div>
</div>
<blockquote class="book-hint warning">
<p>A <strong>synchronized static method</strong> uses the intrinsic lock of the object that represents the class itself (this object is an instance of <code>Class</code>).</p>
</blockquote>
<p>In other words, the two following classes are equivalent:</p>
<div class="book-columns flex flex-wrap">
<div class="flex-even markdown-inner" style="flex-grow: 1;">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">myMethod</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>method body<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  </div>
<div class="flex-even markdown-inner" style="flex-grow: 1;">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">myMethod</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">synchronized</span>(Class.<span style="color:#a6e22e">forName</span>(<span style="color:#e6db74">&#34;my.project.name.MyClass&#34;</span>)){
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>method body<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  </div>
</div>
<h2 id="condition_variable">
  Condition variables
  <a class="anchor" href="#condition_variable">#</a>
</h2>
<p>We saw earlier that a thread $t_1$ can wait for another thread $t_2$ to terminate (e.g. with the pseudocode keyword <code>sync</code> in our abstract model, or in Java with the instance method <code>Thread.join</code>).</p>
<p>In this case, when it terminates, $t_2$ <strong>wakes up</strong> $t_1$, which can resume its execution.</p>
<p>A similar but more flexible mechanism is the notion of <strong>condition variable</strong>.
Intuitively, it allows putting a thread to sleep, and waking it up when a certain condition is verified.</p>
<p>A variety of programming languages support condition variables.
These include C++, C#, Go, Java, Python or Rust.</p>
<h3 id="producerConsumer">
  The producer/consumer pattern
  <a class="anchor" href="#producerConsumer">#</a>
</h3>
<p>A prototypical application of condition variables is the so-called <strong>producer/consumer</strong> pattern.
In this scenario, two pools of threads (usually with fixed sizes) communicate via a <a href="https://unibz-pp-24-25.github.io/docs/abstractdatatypes/sections/queue/#queue">queue</a>.</p>
<ol>
<li>A pool of <strong>producer</strong> threads, which create elements and add (a.k.a. <strong>enqueue</strong>) them to the queue,</li>
<li>A pool of <strong>consumer</strong> threads, which receive (a.k.a. <strong>dequeue</strong>) these elements and process them.</li>
</ol>
<p>Two situations may occur where threads should be put to sleep:</p>
<ul>
<li>the queue is empty (e.g. because the process just started, or because elements have been consumed faster than they were produced): consumers should be put to sleep until a new element is produced.</li>
<li>the queue is full (e.g. because elements have been produced faster than they were consumed): producers should be put to sleep until an element is consumed.</li>
</ul>
<h3 id="in-java-1">
  in Java
  <a class="anchor" href="#in-java-1">#</a>
</h3>
<blockquote class="book-hint warning">
<p><strong><em>Reminder.</em></strong>
As discussed above, a thread can acquire the intrinsic lock of an object by:</p>
<ul>
<li>entering a <a href="#syncStatement">synchronized block</a> that has this object as lock, or</li>
<li>executing a <a href="#syncMethod">synchronized method</a> for this object.</li>
</ul>
</blockquote>
<p>A condition variable in Java can be simulated with a combination of the instance methods <code>Object.wait()</code> and <code>Object.notify()</code> (or <code>Object.notifyAll()</code>).</p>
<h4 id="wait">
  <code>wait</code>
  <a class="anchor" href="#wait">#</a>
</h4>
<p>The instance method $o$<code>.wait()</code> can only be called by a thread that acquired the intrinsic lock of the object $o$.
It has the effect of releasing this lock, and putting the current thread to sleep,
until another thread executes $o$.<code>notify()</code> (or $o$.<code>notifyAll()</code>) (for the same object $o$).</p>
<h4 id="notify">
  <code>notify</code>
  <a class="anchor" href="#notify">#</a>
</h4>
<p>Similarly to $o$<code>.wait()</code>, the instance method $o$<code>.notify()</code> can only be called by a thread that acquired the intrinsic lock of the object.
It has the effect of attempting to wake up <em>one</em> thread (if any) that is waiting for the lock of this object.
The awakened thread will only proceed (i.e. actually wake up) after the notifying thread releases the lock of the object.</p>
<h4 id="notifyAll">
  <code>notifyAll</code>
  <a class="anchor" href="#notifyAll">#</a>
</h4>
<p>The instance method $o$<code>.notifyAll()</code> is identical to $o$<code>.notify()</code>, but attempts to wake up <em>all</em> threads that are waiting for the lock of this object.</p>
<blockquote class="book-hint info">
<p><strong><em>Example.</em></strong>
The following example is an implementation of the producer-consumer pattern borrowed from the <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/guardmeth.html">Oracle tutorials</a>.</p>
<p>For simplicity:</p>
<ul>
<li>we will use a queue with a capacity of 1 (so that the queue is either empty of full),</li>
<li>we assume a single producer and a single consumer.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>pulic <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyQueue</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    T item;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">boolean</span> isEmpty <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">enqueue</span>(T item){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#f92672">!</span>isEmpty){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                wait();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (InterruptedException e) {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">item</span> <span style="color:#f92672">=</span> item;
</span></span><span style="display:flex;"><span>        isEmpty <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        notify();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the producer thread $p$ executes the method <code>enqueue</code>, it acquires the intrinsic lock of the queue (because the method is synchronized).
If the queue is full, it releases the lock and waits for the consumer thread to wake it up.
If this happens, thread $p$:</p>
<ul>
<li>adds the produced item to the queue,</li>
<li>indicates that the queue should now be considered nonempty (a.k.a. full, since the queue has capacity 1),</li>
<li>wakes up the consumer thread (which was waiting for the queue to be nonempty),</li>
<li>releases the intrinsic lock on the queue (by exiting the synchronized method).</li>
</ul>
<p>The method dequeue is symmetric:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyQueue</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">synchronized</span> T <span style="color:#a6e22e">dequeue</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(isEmpty){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                wait();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (InterruptedException e) {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        isEmpty <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        notify();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> item;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>A producer thread could be implemented as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Producer</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Producer</span>(MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">queue</span> <span style="color:#f92672">=</span> queue;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>){
</span></span><span style="display:flex;"><span>            queue.<span style="color:#a6e22e">enqueue</span>(produceItem());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Item <span style="color:#a6e22e">produceItem</span>(){
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And a consumer thread could be implemented as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Consumer</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Consumer</span>(MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">queue</span> <span style="color:#f92672">=</span> queue;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>){
</span></span><span style="display:flex;"><span>            consumeItem(queue.<span style="color:#a6e22e">dequeue</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">consumeItem</span>(Item item){
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Finally, the main thread may spawn one producer and one consumer, as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    MyQueue<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> queue <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MyQueue<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    Thread p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> Producer(queue));
</span></span><span style="display:flex;"><span>    Thread c <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> Consumer(queue));
</span></span><span style="display:flex;"><span>    p.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    c.<span style="color:#a6e22e">start</span>();
</span></span></code></pre></div></blockquote>
<h3 id="spurious-wakeup">
  Spurious wakeup
  <a class="anchor" href="#spurious-wakeup">#</a>
</h3>
<p>In the example above, the loop <code>while(!isEmpty)</code> (in the method <code>enqueue</code>) seems unnecessary, in the sense that it could be replaced with the conditional statements <code>if(!isEmpty)</code>.
And similarly for the loop in the method <code>dequeue</code>.</p>
<p>The purpose of this loop is to handle the abnormal case where a consumer (resp. producer) is awaken while the condition variable <code>isEmpty</code> has value <code>false</code> (resp. <code>true</code>).
Such a situation is called a <a href="https://en.wikipedia.org/wiki/Spurious_wakeup">spurious wakeup</a>, and may have a variety of causes.
For instance, in the example above, if we had two producer threads, then one producer thread could wake up the other (instead of waking up the consumer thread), when it exits the method <code>enqueue</code>.</p>
<p>To avoid spurious wakeups, it is customary to write:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(<span style="color:#f92672">&lt;</span>condition<span style="color:#f92672">&gt;</span>){
</span></span><span style="display:flex;"><span>    wait();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>rather than:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#f92672">&lt;</span>condition<span style="color:#f92672">&gt;</span>){
</span></span><span style="display:flex;"><span>    wait();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#mutual_exclusion">Mutual exclusion</a>
      <ul>
        <li><a href="#in-java">in Java</a></li>
      </ul>
    </li>
    <li><a href="#condition_variable">Condition variables</a>
      <ul>
        <li><a href="#producerConsumer">The producer/consumer pattern</a></li>
        <li><a href="#in-java-1">in Java</a></li>
        <li><a href="#spurious-wakeup">Spurious wakeup</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












